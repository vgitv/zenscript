#!/bin/bash
set -euo pipefail

# Script en mode interactif d'installation des programmes principaux suite à
# l'installation d'ubuntu

function try {
    local action='retry'

    echo '# --------------------------------'
    echo "# $*"

    while [[ "${action}" = 'retry' ]]; do
        if "$@"; then
            echo 'OK'
        else
            echo "ERREUR"
            echo 'Continue ? ( retry / skip )'
            read -r action
            while [[ ! "${action}" =~ (retry|skip) ]]; do
                echo 'Wrong choice ( retry / skip )'
                read -r action
            done
        fi
    done
    echo
}

# package installation
try sudo apt-get -y install git
try sudo apt-get -y install vim-gnome
try sudo apt-get -y install neovim
try sudo apt-get -y install zsh
try sudo apt-get -y install htop
try sudo apt-get -y install ranger
try sudo apt-get -y install build-essential

# settings
try sudo chsh -s /bin/zsh

# make tree
mkdir -p ~/Modèles

# zenscript
git clone https://github.com/vgitv/zenscript ~/Modèles/zenscript
make -C ~/Modèles/zenscript

# bareconfig
# try ~/.local/bin/bareconfig
if git clone --bare https://github.com/vgitv/bareconfig ~/.local/share/bareconfig; then
    function config { git --git-dir="${BARECONFIG:-$HOME/.local/share/bareconfig}" --work-tree="$HOME"; }
    config config --local status.showUntrackedFiles no
    try config checkout
fi

# vim plugins
try curl -LSso ~/.config/nvim/autoload/pathogen.vim https://tpo.pe/pathogen.vim
try git clone https://github.com/morhetz/gruvbox.git ~/.config/nvim/bundle/gruvbox
try git clone https://github.com/preservim/nerdtree.git ~/.config/nvim/bundle/nerdtree

# window manager
try git clone https://github.com/vgitv/dwm-vfork ~/Modèles/dwm-vfork
try git clone https://github.com/vgitv/dwm-utils ~/Modèles/dwm-utils
